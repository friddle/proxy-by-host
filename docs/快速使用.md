# 快速使用指南

## ✅ 服务已成功启动！

当前配置：
- **监听端口**: 8088 (演示)
- **上游服务器**: 47.252.16.154:443 (HTTPS)
- **代理**: http://localhost:7897
- **状态**: ✅ 运行中

## 测试命令

### 方法一：直接使用 Host 头测试

```bash
curl -H "Host: es.prod.code27.cn" http://localhost:8088/
```

### 方法二：配置 hosts 文件（推荐）

1. 编辑 hosts 文件：
```bash
sudo vim /etc/hosts
```

2. 添加一行：
```
127.0.0.1 es.prod.code27.cn
```

3. 直接访问：
```bash
curl http://es.prod.code27.cn:8088/
```

## 使用 80 端口（需要 sudo）

### 自动启动脚本：

```bash
./start_port80.sh
```

### 手动启动：

```bash
sudo UPSTREAM_HOST=47.252.16.154:443 \
     LISTEN_PORT=80 \
     HTTP_PROXY=http://localhost:7897 \
     HTTPS_PROXY=http://localhost:7897 \
     ./simple-proxy
```

启动后测试：
```bash
curl -H "Host: es.prod.code27.cn" http://localhost/
```

## 关于 HTTPS 访问

你提到想用 `curl https://es.prod.code27.cn`，有两种方案：

### 方案一：使用 HTTP（推荐，简单）

配置 hosts 后直接用 HTTP：
```bash
echo '127.0.0.1 es.prod.code27.cn' | sudo tee -a /etc/hosts
curl http://es.prod.code27.cn:8088/
```

### 方案二：配置 Nginx 做 SSL 终止（复杂）

如果必须用 HTTPS，需要：

1. 安装 Nginx
2. 配置 SSL 证书（自签名或 Let's Encrypt）
3. Nginx 配置：

```nginx
server {
    listen 443 ssl;
    server_name es.prod.code27.cn;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://127.0.0.1:8088;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 当前测试结果

✅ **成功！** 服务已验证可以正常工作：

```bash
$ curl -H "Host: es.prod.code27.cn" http://localhost:8088/ -I

HTTP/1.1 302 Found
Kbn-Name: es.prod.code27.cn
Location: /spaces/enter
...
```

## 查看日志

```bash
tail -f /tmp/proxy_final.log
```

## 停止服务

```bash
# 停止8088端口服务
pkill -9 simple-proxy

# 停止80端口服务（如果用sudo启动）
sudo pkill -9 simple-proxy
```

## 完整配置示例

如果你的代理是 `http://localhost:7897`（注意你之前写的是 localhost7897，少了冒号）：

```bash
export UPSTREAM_HOST=47.252.16.154:443
export LISTEN_PORT=8088  # 或 80 (需要 sudo)
export HTTP_PROXY=http://localhost:7897
export HTTPS_PROXY=http://localhost:7897

./simple-proxy
```

## 注意事项

1. ⚠️ **代理地址**: 确保是 `http://localhost:7897` 而不是 `localhost7897`
2. ⚠️ **端口 80**: 需要 sudo 权限
3. ⚠️ **HTTPS**: 我们的代理服务是 HTTP，不是 HTTPS 服务器
4. ✅ **TLS**: 已配置跳过证书验证，可以访问自签名证书的服务器

